{% extends "sidebar.html" %}

{% block title %}Gesti√≥n Usuarios{% endblock %}

{% block content %}
<main class="contenidoGeneral">
    <div class="contenedorTitulo">
        <h1>Gesti√≥n de Usuarios</h1>
        <button class="btnAgregarUsuario" onclick="abrirEAModal()">‚ûï Agregar Usuario</button>
    </div>
    
    <div class="contenedorGestionUsuarios">
        <section class="listaUsuarios">
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Usuario</th>
                        <th>Correo</th>
                        <th>Rol</th>
                        <th>Fecha de Registro</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    {% for usuario in usuarios %}
                    <tr>
                        <td>{{ usuario.Id }}</td>
                        <td>{{ usuario.usuario }}</td>
                        <td>{{ usuario.correo }}</td>
                        <td>{{ usuario.rol }}</td>
                        <td>{{ usuario.creado_en.strftime('%Y-%m-%d %H:%M:%S') if usuario.creado_en else 'N/A' }}</td>
                        <td>
                            <button class="btnVerUsuario" onclick="abrirVerUsuario('{{ usuario.Id }}', '{{ usuario.usuario }}', '{{ usuario.correo }}', '{{ usuario.rol }}', '{{ usuario.creado_en.strftime('%Y-%m-%d %H:%M:%S') if usuario.creado_en else 'N/A' }}')">üëÅÔ∏è</button>
                            <button class="btnEditarUsuario" onclick="abrirEAModal({{ usuario.Id }}, '{{ usuario.usuario }}', '{{ usuario.correo }}', {{ usuario.rol_id }})">‚úèÔ∏è</button>
                            <button class="btnEliminarUsuario" onclick="confirmarEliminar({{ usuario.Id }})">üóëÔ∏è</button>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </section>
    </div>
    
    <!-- Modal de agregar/editar usuario -->
    <section class="modal" id="usuarioModal">
        <section class="contenedorModal">
            <span class="cerrar" onclick="cerrarEAModal()">&times;</span>
            <h3 class="tituloModal" id="tituloModal"></h3>
            <form id="formUsuario" method="POST">
                <input type="hidden" id="idUsuario" name="id">
                <label for="nombreUsuario">Nombre:</label>
                <input type="text" id="nombreUsuario" name="nombre" required>

                <label for="correoUsuario">Correo:</label>
                <input type="email" id="correoUsuario" name="correo" required>
        
                <label for="contrasenaUsuario">Contrase√±a:</label>
                <div class="inputContrasena">
                    <input type="password" id="contrasenaUsuario" name="contrasena" required>
                    <span class="toggleContrasena" onclick="toggleContrasena()">üëÅÔ∏è</span>
                </div>
        
                <label for="tipoPrivilegio">Tipo de Privilegio:</label>
                <select id="tipoPrivilegio" name="tipoPrivilegio" required>
                    {% for rol in roles %}
                    <option value="{{ rol.Id }}">{{ rol.rol }}</option>
                    {% endfor %}
                </select>
                <br>
                <br>
                <button class="guardarBtn" type="submit">Guardar</button>
            </form>
        </section>
    </section>

    <!-- Modal de ver usuario -->
    <section class="modal" id="verModalUsuario">
        <section class="contenedorModal">
            <span class="cerrar" onclick="cerrarVerUsuario()">&times;</span>
            <h3 id="verTituloModal">Ver Usuario</h3>
            <section id="verDetallesUsuario">
                <p><strong>ID:</strong> <span id="verIDUsuario"></span></p>
                <p><strong>Nombre:</strong> <span id="verNombreUsuario"></span></p>
                <p><strong>Correo:</strong> <span id="verCorreoUsuario"></span></p>
                <p><strong>Tipo de Privilegio:</strong> <span id="verTipoPrivilegio"></span></p>
                <p><strong>Fecha de Registro:</strong> <span id="verFechaRegistro"></span></p>
                <p><strong>Contrase√±a:</strong> <span id="verContrasenaUsuario"></span></p>
            </section>
        </section>
    </section>
    
    <script>
    function confirmarEliminar(id) {
        if (confirm('¬øEst√°s seguro de que deseas eliminar este usuario?')) {
            window.location.href = '/gestionUsuarios/eliminar/' + id;
        }
    }
    </script>
    
    <script src="{{ url_for('static', filename='js/gestionUsuarios.js') }}"></script>
</main>
{% endblock %}