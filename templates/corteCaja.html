{% extends "sidebar.html" %}

{% block title %}Corte de Caja{% endblock %}

{% block content %}

<main class="contenidoGeneral">
    <div class="contenedorTitulo">
        <h1>Corte de Caja</h1>
        <button id="btnAgregarCorte" class="btnAgregarCorte">Realizar Corte</button>
    </div>

    <section class="buscador">
        <section id="formBuscador">
            <input type="text" id="buscarUsuario" placeholder="Buscar por nombre" name="usuario" oninput="buscarUsuario()">
            <label for="fechaInicio">Desde:</label>
            <input type="date" id="fechaInicio" name="fechaInicio" onchange="buscarUsuario()">
            <label for="fechaFin">Hasta:</label>
            <input type="date" id="fechaFin" name="fechaFin" onchange="buscarUsuario()">
            <button type="button" class="btnReestablecer" onclick="reestablecerFiltros()">ðŸ”„ Reestablecer</button>
        </section>
    </section>

    <!-- Tabla Principal -->
    <table class="table">
        <thead>
            <tr>
                <th>Fecha</th>
                <th>Fondo</th>
                <th>Contado</th>
                <th>Calculado</th>
                <th>Pagos realizados</th>
            </tr>
        </thead>
        <tbody>
            {% for corte in cortes %}
            <tr>
                <td>{{ corte.fecha_hora_cierre.strftime('%Y-%m-%d') }}</td>
                <td>${{ corte.fondo }}</td>
                <td>${{ corte.total_contado }}</td>
                <td>${{ corte.total_ventas }}</td>
                <td>${{ corte.pagos_realizados }}</td>
            </tr>
            {% else %}
            <tr>
                <td colspan="5">No hay registros de corte de caja aÃºn.</td>
            </tr>
            {% endfor %}
        </tbody>
        
    </table>

    <!-- Modal de Corte de Caja -->
    <div id="miModal" class="modal">
        <div class="modal-content">
            <span class="cerrar" id="cerrarModal">&times;</span>
            <h2>Corte de Caja</h2>

            <div class="modal-container">
                <div class="fecha-selector">
                    <div class="fecha-item">
                        <label for="fechaDesde">Desde</label>
                        <input type="datetime-local" id="fechaDesde">
                    </div>
                    <div class="fecha-item">
                        <label for="fechaHasta">Hasta</label>
                        <input type="datetime-local" id="fechaHasta">
                    </div>
                    <button id="btnFiltrarFechas" class="btnFiltrar">Filtrar Fechas</button>
                </div>

                <table class="table">
                    <tr>
                        <th> </th>
                        <th>Contado</th>
                        <th>Calculado</th>
                        <th>Diferencia</th>
                    </tr>
                    <tr>
                        <td>Efectivo</td>
                        <td><input type="number" class="input-field" id="contado" value="0"></td>
                        <td><input type="number" class="input-field" id="calculado" value="{{ totales['efectivo'] }}" readonly></td>
                        <td><input type="number" class="input-field" id="diferencia" value="0" readonly></td>
                    </tr>
                    <tr>
                        <td>Transferencias</td>
                        <td><input type="number" class="input-field" id="cheque" value="0"></td>
                        <td><input type="number" class="input-field" id="calculadoCheque" value="{{ totales['transferencia'] }}" readonly></td>
                        <td><input type="number" class="input-field" id="diferenciaCheque" value="0" readonly></td>
                    </tr>
                    <tr>
                        <td>PayPal</td>
                        <td><input type="number" class="input-field" id="vales" value="0"></td>
                        <td><input type="number" class="input-field" id="calculadoVales" value="{{ totales['paypal'] }}" readonly></td>
                        <td><input type="number" class="input-field" id="diferenciaVales" value="0" readonly></td>
                    </tr>
                    <tr>
                        <td>Total</td>
                        <td><input type="number" class="input-field" id="total" value="0" readonly></td>
                        <td><input type="number" class="input-field" id="total2" value="0" readonly></td>
                        <td><input type="number" class="input-field" id="totalDiferencia" value="0" readonly></td>
                    </tr>                    
                </table>
                <table class="table">
                    <tr>
                        <td>Fondo</td>
                        <td><input type="number" class="input-field" id="fondo" value="0"></td>
                    </tr>
                    <tr>
                        <td>Pagos realizados</td>
                        <td><input type="number" class="input-field" id="pagos_realizados" value="0"></td>
                    </tr>
                </table>
                <div class="contenedor">
                <button id="btnRealizarCorte" class="btnRealizar">Realizar Corte</button>
                <button id="btnCalcularCorte" class="btnRealizar">Calcular Corte</button>
                </div>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/corteCaja.js') }}"></script>
    <script src="{{ url_for('static', filename='js/filtrarVentas.js') }}"></script>

</main>
{% endblock %}