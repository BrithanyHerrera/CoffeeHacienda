{% extends "sidebar.html" %}

{% block title %}Gesti√≥n Productos{% endblock %}

{% block content %}
<main class="contenidoGeneral">
    <div class="contenedorTitulo">
        <h1>Gesti√≥n de Productos</h1>
        <button class="btnAgregarProducto" onclick="abrirEAModal()">‚ûï Agregar Producto</button>
    </div>
    
    <section class="buscador">
        <section id="formBuscador">
            <!-- Campo de b√∫squeda por nombre -->
            <input type="text" id="buscarNombre" placeholder="Buscar por nombre" name="nombre" oninput="filtrarProductos()">
            
            <!-- Filtro por tama√±o -->
            <div class="filtroSelect">
                <select id="buscarTamano" name="tamano" onchange="filtrarProductos()">
                    <option value="">Todos los tama√±os</option>
                    {% for tamano in tamanos %}
                    <option value="{{ tamano.tamano }}">{{ tamano.tamano }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="filtroSelect">
                <!-- Filtro por categor√≠a -->
                <select id="buscarCategoria" name="categoria" onchange="filtrarProductos()">
                    <option value="">Todas las categor√≠as</option>
                    {% for categoria in categorias %}
                    <option value="{{ categoria.categoria }}">{{ categoria.categoria }}</option>
                    {% endfor %}
                </select>
            </div>

            <!-- Bot√≥n para restablecer los filtros -->
            <button type="button" class="btnReestablecer" onclick="reestablecerFiltros()">üîÑ Reestablecer</button>
        </section>
    </section>
    
    

    <div class="contenedorGestionProductos">
        <section class="listaProductos">
            <table>
                <thead>
                    <tr>
                        <th>Nombre</th>
                        <th>Tama√±o</th>
                        <th>Categoria</th>
                        <th>Precio</th>
                        <th>Imagen</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody id="productosLista">
                    {% for producto in productos %}
                    <tr>
                        <td>{{ producto.nombre_producto }}</td>

                        <td class="tamanoProducto" data-producto-id="{{ producto.Id }}">
                            {% if producto.variantes and producto.variantes|length > 0 %}
                                {% for variante in producto.variantes %}
                                    {{ variante.tamano }}{% if not loop.last %}, {% endif %}
                                {% endfor %}
                            {% else %}
                                No Aplica
                            {% endif %}
                        </td>

                        <td class="categoriaProducto">
                            {% if producto.categoria %}
                                {{ producto.categoria }}
                            {% else %}
                                Sin categor√≠a
                            {% endif %}
                        </td>

                        <td>${{ producto.precio }}</td>

                        <td>
                            {% if producto.ruta_imagen %}
                            <img src="{{ producto.ruta_imagen }}" alt="{{ producto.nombre_producto }}" class="imagenProducto">
                            {% else %}
                            <img src="/static/images/default-product.jpg" alt="Sin imagen" class="imagenProducto">
                            {% endif %}
                        </td>

                        <td>
                            <button class="btnVerProducto" onclick="abrirVerProducto('{{ producto.Id }}')">üëÅÔ∏è</button>
                            <button class="btnEditarProducto" onclick="abrirEAModal('{{ producto.Id }}')">‚úèÔ∏è</button>
                            <button class="btnEliminarProducto" onclick="eliminarProducto('{{ producto.Id }}')">üóëÔ∏è</button>                            
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </section>

        <!-- Modal de Agregar/Editar Producto -->
        <section class="modal" id="productoModal">
            <section class="contenedorModal">
                <span class="cerrar" onclick="cerrarEAModal()">&times;</span>
                <h3 class="tituloModal" id="tituloModal">Agregar Producto</h3>

                <form id="formProducto" enctype="multipart/form-data">
                    <input type="hidden" id="idProducto" name="id">
                    
                    <section class="contenedorIzquierdo">
                        <label for="nombreProducto">Nombre:</label>
                        <input type="text" id="nombreProducto" name="nombreProducto" required>

                        <label for="descripcionProducto">Descripci√≥n:</label>
                        <textarea id="descripcionProducto" name="descripcionProducto" rows="3"></textarea>

                        <label for="tamanoProducto">Tama√±o:</label>
                        <select id="tamanoProducto" name="tamanoProducto">
                            <option value="">Seleccione un tama√±o</option>
                            {% for tamano in tamanos %}
                            <option value="{{ tamano.Id }}">{{ tamano.tamano }}</option>
                            {% endfor %}
                        </select>

                        <label for="precioProducto">Precio:</label>
                        <input type="number" id="precioProducto" name="precioProducto" step="1" min="0" required placeholder="Ingrese el precio">

    
                        <label for="stockProducto">Stock:</label>
                        <input type="number" id="stockProducto" name="stockProducto" min="0" required placeholder="Ingrese el stock">
                    </section>

                    <section class="contenedorDerecho">
                        <label for="stockMinProducto">Stock M√≠nimo:</label>
                        <input type="number" id="stockMinProducto" name="stockMinProducto" min="0" required placeholder="Ingrese el stock m√≠nimo">
    
                        <label for="stockMaxProducto">Stock M√°ximo:</label>
                        <input type="number" id="stockMaxProducto" name="stockMaxProducto" min="0" required placeholder="Ingrese el stock m√°ximo">

                        <label for="categoriaProducto">Categor√≠a:</label>
                        <select id="categoriaProducto" name="categoriaProducto" required>
                            <option value="">Seleccione una categor√≠a</option>
                            {% for categoria in categorias %}
                            <option value="{{ categoria.Id }}">{{ categoria.categoria }}</option>
                            {% endfor %}
                        </select>

                        <label for="imagenProducto">Imagen:</label>
                        <input type="file" id="imagenProducto" name="imagenProducto" accept="image/*">
                        <img id="imagenActual" class="imagenProducto" src="" alt="Imagen Actual" style="display: none; max-width: 200px; margin-top: 10px;">

                        <button class="guardarBtn" type="submit">Guardar</button>
                    </section>
                </form>
            </section>
        </section>
        
        <!-- Modal de Ver Producto -->
        <section class="modal" id="verModalProducto">
            <section class="contenedorModal">
                <span class="cerrar" onclick="cerrarVerProducto()">&times;</span>
                <h3 id="verTituloModal">Ver Producto</h3>
                
                <section id="verDetallesProducto">
                    <p><strong>ID:</strong> <span id="verIDProducto"></span></p>
                    <p><strong>Nombre:</strong> <span id="verNombreProducto"></span></p>
                    <p><strong>Descripci√≥n:</strong> <span id="verDescripcionProducto"></span></p>
                    <p><strong>Precio:</strong> $<span id="verPrecioProducto"></span></p>
                    <p><strong>Tama√±o:</strong> <span id="verTamanoProducto"></span></p>
                    <p id="verStockLabel"><strong>Stock:</strong> <span id="verStockProducto"></span></p>
                    <p id="verStockMinLabel"><strong>Stock M√≠nimo:</strong> <span id="verStockMinProducto"></span></p>
                    <p id="verStockMaxLabel"><strong>Stock M√°ximo:</strong> <span id="verStockMaxProducto"></span></p>
                    <p><strong>Categor√≠a:</strong> <span id="verCategoriaProducto"></span></p>
                    <p><strong>Imagen:</strong></p>
                    <img id="verImagenProducto" class="imagenProducto" alt="Imagen del Producto" style="max-width: 300px;">
                </section>
            </section>
        </section>
    </div>
    
    <script src="{{ url_for('static', filename='js/gestionProductos.js') }}"></script>
</main>
{% endblock %}
